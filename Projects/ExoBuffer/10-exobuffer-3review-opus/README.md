# ExoBuffer v3.0 产品规格书

> **版本**: v3.0（四模型会审综合版）
> **日期**: 2026-01-12
> **序号**: 10-exobuffer-3review-opus
> **状态**: 需求定义完成，待实现

---

## 1. 问题陈述

用户在日常阅读和学习中面临信息过载与价值筛选困境：

1. **信息入口分散**：微信、小红书、知乎、浏览器收藏散落各处
2. **价值判断困难**：每篇文章都需花时间阅读才能判断是否有价值
3. **知识沉淀低效**：有价值内容难以快速归档到知识库（Obsidian）
4. **跨设备协作弱**：手机采集的内容无法便捷在 PC 上处理

---

## 2. 期望结果

| 目标       | 具体表现                                   |
| -------- | -------------------------------------- |
| **统一入口** | 任何设备都能快速分享链接或内容                        |
| **智能筛选** | 分享后自动评估内容价值（0-10分）和建议行动                |
| **无缝导出** | 高价值内容自动整理到 Obsidian `0-Inbox/` 目录      |
| **协作顺畅** | 手机采集内容自动同步到 PC 处理                      |
| **离线可用** | 网络不佳时不影响采集（Phase 2）                    |

---

## 3. 成功标准

### 3.1. Phase 1（单机 MVP，1-4周）

- [ ] 微信分享链接 → PC 端收到并处理
- [ ] 处理完成后生成：`原文.md` + `评估.md` + `meta/metadata.json`
- [ ] Scout 评估输出：价值评分(0-10)、建议行动、核心观点、资源链接
- [ ] Scout 输出遵循 **v1.4 协议**（详见 [[SCOUT_PROTOCOL]]）
- [ ] Web 端（PWA）可通过浏览器访问和管理
- [ ] 单链接端到端处理时间 < 30 秒（本地）

### 3.2. Phase 2（移动端深化，5-8周）

- [ ] **PWA 作为移动端主力**（放弃 Phase 1 Tauri Mobile）
- [ ] 离线时本地缓存采集内容
- [ ] 节点状态可视化（手机端状态、PC 端状态）
- [ ] 混合同步策略（详见 [[NODE_SYNC]]）

### 3.3. Phase 3（商业化，9-16周）

> **注意**：商业化细节将独立成文档，本规格聚焦 Phase 1-2。

- [ ] 用户注册/登录系统
- [ ] License Key 激活
- [ ] 订阅制计费
- [ ] 云端 Agent 节点（可选）

---

## 4. 核心需求

### 4.1. R1: 聊天风格交互界面

**为什么**：用户习惯聊天界面，Agent 像助手一样对话
**什么**：
- 左侧：Agent 消息（摘要、评分、建议）
- 右侧：用户消息（链接、图片、文本）

### 4.2. R2: 任务进度可视化

**为什么**：用户需要知道当前处理状态
**什么**：
- 步骤展示：下载 → 提取 → 评估 → 导出
- 百分比进度 + 实时日志
- 取消/重试操作
- **WebSocket 实时通信**（必须实现）

### 4.3. R3: Agent 处理流程

**为什么**：自动化价值评估，减少人工筛选成本
**什么**：Scout 评估遵循 **v1.4 协议**，详见 [[SCOUT_PROTOCOL]]

| 模块 | 功能 | 实现 |
|------|------|------|
| Router | URL 平台识别 | 正则匹配 (TypeScript) |
| Extractor | 提取内容为 Markdown | TypeScript 重写，逻辑对齐 scout_converter |
| Scout | LLM 评估 | LangChain.js + OpenAI 兼容协议 |
| Exporter | 写入 Obsidian | 文件系统操作 (Node.js fs) |

### 4.4. R4: 多节点协作

**为什么**：手机采集、PC 处理
**什么**：详见 [[NODE_SYNC]]

### 4.5. R5: Obsidian 集成

**为什么**：与现有知识库打通
**什么**：
- 目录结构：`0-Inbox/YYYYMMDD-HHmm-摘要/`
- 文件：`原文.md` + `评估.md` + `meta/metadata.json`
- 引用格式：支持 Obsidian Wiki 链接

---

## 5. 约束条件

| 编号  | 约束                         | 原因                         |
| --- | -------------------------- | -------------------------- |
| C1  | 本地部署不依赖 Redis/Celery       | 避免额外服务依赖                   |
| C2  | SQLite 作为主数据库              | 轻量、无依赖                     |
| C3  | **TypeScript 优先**          | 从 Demo 到正式版技术栈一致            |
| C4  | HTML 缓存默认 7 天过期            | 资源有限，避免无限增长                |
| C5  | Python 仅作辅助工具              | 核心逻辑用 TypeScript，避免混合栈债务   |

---

## 6. 技术方案（用户决策版）

> **核心原则**：需求不变，技术可变。**TypeScript 统一全栈**，从 Demo 到正式版保持一致。

### 6.1. TypeScript 统一全栈

| 层级 | 推荐方案 | 说明 |
|------|----------|------|
| **Desktop** | Tauri v2 (Rust) | 系统集成层 |
| **Frontend** | React + TypeScript | 统一 UI |
| **Backend** | Fastify (Node.js) | API 服务 |
| **Agent** | LangChain.js | LLM 调用框架 |
| **Mobile** | **PWA**（Phase 1/2 主力） | 与桌面共享代码 |

**Python 定位**：辅助工具层（可选），不作为核心逻辑。

### 6.2. 调用链

```
Tauri (Rust) → Fastify (Node.js) → LangChain.js
                    ↓
              SQLite + LLM API
                    ↓
            [可选] Python 工具脚本
```

**优势**：Demo → MVP → 正式版技术栈一致，避免技术债务。

### 6.3. 目录结构

```
exobuffer/
├── apps/
│   ├── desktop/      # Tauri 桌面
│   └── web/          # PWA Web
├── packages/
│   ├── core/         # Python 核心逻辑
│   └── scripts/      # 复用脚本
└── docs/
    ├── SCOUT_PROTOCOL.md  # Scout 协议规格
    └── NODE_SYNC.md       # 节点同步规格
```

---

## 7. 风险与缓解

| 风险              | 概率 | 影响 | 缓解                          |
| --------------- | -- | -- | --------------------------- |
| Tauri Mobile 不成熟 | 中  | 高  | Phase 1/2 优先 PWA            |
| LLM API 限流       | 中  | 中  | 重试机制 + 本地缓存                 |
| LangChain.js 生态较新 | 中  | 中  | 核心功能简单，不依赖高级特性 |
| 数据同步冲突          | 中  | 中  | 时间戳优先 + 用户确认                |
| 用户付费意愿不足        | 高  | 高  | 先验证 MVP，渐进式付费               |

---

## 8. 资产继承声明

以下资产从前序版本继承：

| 资产 | 来源 | 继承方式 |
|------|------|----------|
| BufferItem 数据模型 | 06-MiniMax | 保留，转为 TypeScript interface |
| Scout Prompt v1.4 | 08-TECH_SPEC | 保留并独立成 [[SCOUT_PROTOCOL]] |
| Extractor 抽象接口 | 06-MiniMax | 简化后用 TypeScript 重写 |
| `scout_converter.py` 逻辑 | 07-Gemini3 | 逻辑对齐，用 TypeScript 重写 |

---

## 9. 相关文档

| 文档          | 路径                                                                  |
| ----------- | ------------------------------------------------------------------- |
| Scout 协议规格  | [[SCOUT_PROTOCOL]]                                               |
| 节点同步规格      | [[NODE_SYNC]]（Phase 2）                                           |
| 前序技术规格      | `output/08-exobuffer-review/09-EXOBUFFER_TECH_SPEC.md`              |
| LeanSpec 原则 | https://www.lean-spec.dev/zh-Hans/docs/guide/understanding-leanspec |

---

## 10. 演进记录

| 版本 | 日期       | 变更                                |
| -- | -------- | --------------------------------- |
| v3.0 | 2026-01-12 | 四模型会审综合版：简化技术栈、PWA 优先、Scout 协议独立 |
| v2.0 | 2026-01-12 | LeanSpec 需求优先版                    |
| v1.0 | 2026-01-12 | 初始版本                              |

---

> **核心原则**：需求不变，技术可变。简洁优先，渐进式披露。
