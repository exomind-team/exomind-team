# 微信公众号文章抓取技术方案 (ExoBuffer 核心)

## 1. 核心挑战与现状
- **环境**: 微信具有严格的反爬机制（JS 动态渲染、环境异常验证）。
- **突破口**: 
    - **JavaScript 变量打捞**: 元数据（时间、标题、作者）硬编码在 HTML 源码变量中。
    - **无损转换**: 利用 `markdownify` + `BeautifulSoup` 自主控制 Markdown 质量。
- **当前状态**: 已解除对 `wechat-article-exporter` 的强依赖，实现自主直连。

---

## 2. 分层分发方案 (Tiered Strategy)

### 2.1. 核心方案：Scout Converter (Protein V3) ⭐
- **工具**: `scout_converter.py`
- **原理**: 使用 Python `urllib` 模拟浏览器直接请求 URL，解析 JS 变量提取元数据，并执行样式保留转换。
- **优点**: 100% 自控，无外部服务依赖，元数据最全（含精确秒级发布时间）。
- **适用**: 绝大多数微信公众号文章。

### 2.2. 备选方案：Local/Remote API
- **请求地址**: `http://localhost:3000/api/public/v1/download` 或 `https://down.mptext.top/...`
- **参数**: `url=<encoded_url>&format=html`
- **用途**: 当直连方案被微信彻底封禁 IP 或需要特定解析格式时使用。

### 2.3. 战略储备：WeWe-RSS
- **原理**: 微信读书中转。
- **适用**: 需要长期稳定自动订阅、批量采集场景。

---

## 3. AI 处理规范 (For Agents)
当 Agent 执行抓取任务时，必须遵循以下“蛋白质”逻辑：
1. **获取原文**: 优先调用 `scout_converter.py <URL>`。
2. **元数据打捞**: 必须从 `var ct`, `var msg_title`, `var author` 等 JS 变量中提取。
3. **清洗规则**:
    - 移除冗余文本（如：“在小说阅读器中沉浸阅读”）。
    - 移除 CSS 样式块（如：`#js_row_immersive_stream_wrap` 相关）。
    - 移除 `font-size` 等视觉噪音。
4. **样式保留**: 必须保留 `color` 和 `font-weight` 以维持原文阅读精度。
5. **格式规范**: 每一段落之间仅保留一段空行。

---

## 4. 法律与合规
- **原则**: 仅用于个人学习与研究，严禁二次分发。
- **限制**: 建议单日单 IP 抓取量控制在 50 篇以内。

---
**更新时间**: 2026-01-06 (Scout V3 架构就绪)