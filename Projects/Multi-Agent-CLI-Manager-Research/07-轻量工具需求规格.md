# LeanSpec 轻量管理工具需求规格

> 文档版本：v1.0
> 创建日期：2026年1月9日
> 基于：LeanSpec v0.7（外心系统概念）

---

## 一、项目概述

### 1.1 项目名称

| 项目 | 名称 |
|-----|------|
| 代号 | ScoutPanel / LeanTerm |
| 全称 | LeanSpec Agent Management Tool |
| 定位 | 轻量级多 Agent 任务管理与监控工具 |

### 1.2 背景

**问题**：
- Vibe Kanban 不适用于非编码场景（Obsidian Vault 无法识别）
- 现有 CLI Agent（Claude Code、Gemini CLI）缺乏统一管理界面
- 任务进度、窗口标题、提示音等需求未被满足

**解决方案**：
开发一个轻量级工具，专门服务于 LeanSpec 场景下的个人知识管理与 Agent 协作。

### 1.3 设计目标

| 目标 | 说明 |
|-----|------|
| **轻量** | 快速启动，低资源占用，零依赖部署 |
| **专注** | 只做多窗口管理和通知，不做复杂编排 |
| **可追溯** | 事件日志记录所有操作 |
| **跨平台** | Windows/macOS/Linux 全支持 |
| **可扩展** | 插件式 Agent 适配器 |

---

## 二、核心需求

### 2.1 功能需求

#### FR-001：多窗口管理

| 需求编号 | FR-001 |
|---------|--------|
| 需求名称 | 多窗口任务管理 |
| 优先级 | P0 |
| 描述 | 支持创建、管理多个独立的 Agent 终端窗口 |
| 输入 | 窗口名称、任务类型、Agent 配置 |
| 输出 | 多个可独立操作的终端窗口 |
| 业务规则 | 每个窗口独立运行，互不干扰 |

#### FR-002：窗口标题动态更新

| 需求编号 | FR-002 |
|---------|--------|
| 需求名称 | 窗口标题自定义 |
| 优先级 | P0 |
| 描述 | 窗口标题实时显示任务状态信息 |
| 格式 | `[Agent] 任务名 - 状态 - 进度%` |
| 示例 | `[Scout] 市场调研 - 运行中 - 35%` |

#### FR-003：进度状态可视化

| 需求编号 | FR-003 |
|---------|--------|
| 需求名称 | 进度状态跟踪 |
| 优先级 | P0 |
| 描述 | 实时显示每个任务的执行进度 |
| 状态类型 | 等待中、运行中、等待输入、完成、错误 |
| 进度指标 | 百分比、时间估算、阶段标识 |

#### FR-004：提示音与通知

| 需求编号 | FR-004 |
|---------|--------|
| 需求名称 | 事件通知系统 |
| 优先级 | P0 |
| 描述 | 任务状态变化时触发提示音和系统通知 |
| 事件类型 | 任务开始、完成、出错、需要输入 |
| 通知方式 | 声音 + 系统弹窗 |

#### FR-005：Agent 适配器

| 需求编号 | FR-005 |
|---------|--------|
| 需求名称 | 多 Agent 支持 |
| 优先级 | P1 |
| 描述 | 支持主流 CLI Agent 的统一管理 |
| 支持列表 | Claude Code CLI、Gemini CLI、Aider、OpenCode |
| 适配方式 | 插件式架构，按需加载 |

#### FR-006：事件日志

| 需求编号 | FR-006 |
|---------|--------|
| 需求名称 | 执行记录追溯 |
| 优先级 | P1 |
| 描述 | 记录所有操作和状态变化，支持追溯 |
| 记录内容 | 时间、事件类型、Agent、状态、输出摘要 |

### 2.2 非功能需求

| 编号 | 需求 | 目标值 |
|-----|------|--------|
| NFR-001 | 启动时间 | < 3秒 |
| NFR-002 | 内存占用 | < 50MB |
| NFR-003 | 窗口创建时间 | < 500ms |
| NFR-004 | 状态更新延迟 | < 1秒 |
| NFR-005 | 系统兼容性 | Windows 10+/macOS 11+/Ubuntu 20.04+ |
| NFR-006 | 事件日志保留 | 30天 |

---

## 三、系统架构

### 3.1 整体架构

```
┌─────────────────────────────────────────────────────────────────┐
│                        ScoutPanel                               │
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                     UI Layer (Web/CLI)                       ││
│  │  ┌───────────┐ ┌───────────┐ ┌───────────────────────────┐ ││
│  │  │ Dashboard │ │ Task View │ │ Event Log                 │ ││
│  │  └───────────┘ └───────────┘ └───────────────────────────┘ ││
│  └─────────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                     Core Layer                               ││
│  │  ┌───────────┐ ┌───────────┐ ┌───────────────────────────┐ ││
│  │  │ Window    │ │ Task      │ │ Event Bus                 │ ││
│  │  │ Manager   │ │ Scheduler │ │                           │ ││
│  │  └───────────┘ └───────────┘ └───────────────────────────┘ ││
│  └─────────────────────────────────────────────────────────────┘│
├─────────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────────────┐│
│  │                     Adapter Layer                            ││
│  │  ┌───────────┐ ┌───────────┐ ┌───────────────────────────┐ ││
│  │  │ Claude    │ │ Gemini    │ │ Custom Agent              │ ││
│  │  │ Adapter   │ │ Adapter   │ │ Adapter                   │ ││
│  │  └───────────┘ └───────────┘ └───────────────────────────┘ ││
│  └─────────────────────────────────────────────────────────────┘│
└─────────────────────────────────────────────────────────────────┘
```

### 3.2 数据模型

#### Task（任务）

```typescript
interface Task {
  id: string;
  name: string;
  agentType: 'claude' | 'gemini' | 'aider' | 'custom';
  status: 'pending' | 'running' | 'waiting_input' | 'completed' | 'error';
  progress: number;        // 0-100
  stage: string;           // 当前阶段
  startTime: Date;
  endTime?: Date;
  outputSummary?: string;
  windowId?: string;
}
```

#### Event（事件）

```typescript
interface Event {
  id: string;
  timestamp: Date;
  taskId: string;
  type: 'start' | 'progress' | 'complete' | 'error' | 'input_required';
  message: string;
  data?: Record<string, any>;
}
```

#### WindowConfig（窗口配置）

```typescript
interface WindowConfig {
  id: string;
  title: string;
  agentType: string;
  workingDir: string;
  envVars: Record<string, string>;
  shell: string;
}
```

---

## 四、界面设计

### 4.1 CLI 界面设计

#### Dashboard 视图

```
┌─────────────────────────────────────────────────────────────────────────┐
│  ScoutPanel v1.0 - LeanSpec Agent Manager                      [ Quit ] │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                          │
│  ┌─ Tasks ────────────────────────────────────────────────────────────┐ │
│  │ ID │ Name         │ Agent    │ Status   │ Progress │ Stage        │ │
│  ├───┼──────────────┼──────────┼──────────┼──────────┼──────────────┤ │
│  │ 1  │ 市场调研     │ Claude   │ 🟢运行中 │ 35%     │ 信息收集     │ │
│  │ 2  │ 竞品分析     │ Gemini   │ 🟡等待   │ 0%      │ 初始化       │ │
│  │ 3  │ 规格编写     │ Claude   │ ⚪空闲   │ -       │ -            │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  ┌─ Event Log ────────────────────────────────────────────────────────┐ │
│  │ [20:15:23] T1: 开始执行 - 市场调研                                 │ │
│  │ [20:15:45] T1: 阶段更新 - 信息收集 (35%)                           │ │
│  │ [20:16:12] T2: 任务创建 - 竞品分析                                 │ │
│  └────────────────────────────────────────────────────────────────────┘ │
│                                                                          │
│  Commands: [n]ew task  [s]top  [r]esume  [v]iew  [l]ogs  [q]uit        │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

#### 窗口标题格式

| 状态 | 格式 | 示例 |
|-----|------|------|
| 运行中 | `[Agent] 任务名 - 运行中 - 进度%` | `[Claude] 市场调研 - 运行中 - 35%` |
| 等待输入 | `[Agent] 任务名 - 等待输入` | `[Claude] 市场调研 - 等待输入` |
| 完成 | `[Agent] 任务名 - ✅ 完成` | `[Claude] 市场调研 - ✅ 完成` |
| 错误 | `[Agent] 任务名 - ❌ 错误` | `[Claude] 市场调研 - ❌ 错误` |

### 4.2 进度可视化

```
状态图标：
🟢 运行中 - 任务正在执行
🟡 等待输入 - 暂停等待用户响应
⚪ 空闲 - 任务未开始或已释放
🟢✅ 完成 - 成功完成
🔴❌ 错误 - 执行出错

进度条样式：
██████████░░░░ 60%  信息收集
```
---

## 五、技术选型

### 5.1 方案对比

| 方案 | 技术栈 | 优点 | 缺点 | 推荐度 |
|-----|-------|------|-----|--------|
| **A: CLI + TUI** | Rust + ratatui | 高性能、跨平台 | 界面有限 | ⭐⭐⭐⭐ |
| **B: 桌面应用** | Tauri + React | 界面美观、功能强 | 较重 | ⭐⭐⭐ |
| **C: Web 应用** | Node.js + Vue | 开发快、跨平台 | 需要浏览器 | ⭐⭐ |
| **D: CLI + 脚本** | Python/Shell | 最简单 | 功能有限 | ⭐⭐⭐ |

### 5.2 推荐方案：方案 A（CLI + TUI）

**理由**：
1. 轻量级，启动快
2. 终端内使用，符合开发者习惯
3. Rust 保证性能和安全性
4. 可后续扩展为 Tauri 桌面应用

**技术栈**：
- **语言**：Rust
- **TUI 框架**：ratatui（或 cursive）
- **进程管理**：std::process
- **事件系统**：tokio + mpsc
- **数据存储**：SQLite（可选）

---

## 六、开发计划

### 6.1 MVP（最小可行产品）

**目标**：完成核心功能，验证可行性

| 周 | 任务 | 交付物 |
|---|-----|--------|
| 1 | 基础架构 + 窗口管理 | 可创建多个 Agent 窗口 |
| 2 | 状态跟踪 + 进度显示 | 实时更新任务状态 |
| 3 | 通知系统 + 事件日志 | 提示音 + 系统通知 |

**核心 MVP 功能**：
- [ ] 多 Agent 窗口管理
- [ ] 窗口标题动态更新
- [ ] 基础状态跟踪
- [ ] 事件日志

### 6.2 完整版

| 周 | 任务 | 交付物 |
|---|-----|--------|
| 4 | Agent 适配器框架 | Claude/Gemini 适配器 |
| 5 | 通知系统完善 | 提示音 + 系统通知 |
| 6 | Web UI（可选） | 浏览器管理界面 |
| 7 | 测试 + 文档 | 完整测试用例 + 用户文档 |

---

## 七、CLI 命令设计

### 7.1 命令结构

```bash
scout [全局选项] <命令> [参数]

# 全局选项
--config FILE     # 配置文件路径
--data-dir DIR    # 数据目录
--verbose         # 详细输出
--help            # 帮助
--version         # 版本

# 命令
new         # 创建新任务
list        # 列出任务
status      # 查看任务状态
stop        # 停止任务
logs        # 查看日志
config      # 配置管理
```

### 7.2 详细命令

#### 创建任务

```bash
scout new <name> --agent <agent> --task <task>

# 示例
scout new "市场调研" --agent claude --task "分析新能源汽车市场趋势"
```

#### 列表任务

```bash
scout list [--status running|completed|all]
```

#### 查看状态

```bash
scout status <task_id>
```

#### 查看日志

```bash
scout logs <task_id> [--follow]
```

#### 停止任务

```bash
scout stop <task_id>
```

---

## 八、与 LeanSpec 的集成

### 8.1 对齐 LeanSpec 概念

| LeanSpec 概念 | ScoutPanel 实现 |
|--------------|-----------------|
| Scout Agent | `scout new "xxx" --agent claude` |
| Governor | 任务调度策略配置 |
| Daily Loop | 任务模板 + 批量执行 |
| EventLog | `scout logs` + SQLite 存储 |

### 8.2 任务模板

```yaml
# templates/daily-loop.yaml
name: "Daily Morning"
agents:
  - name: "晨间扫描"
    agent: claude
    prompt: "侦察今天最重要的3条信息..."
    schedule: "7:00"
  - name: "任务推荐"
    agent: claude
    prompt: "基于当前上下文，推荐今天最重要的一件事..."
    depends_on: "晨间扫描"
```

---

## 九、成本估算

### 9.1 开发成本

| 阶段 | 人力（人月） | 成本（元） |
|-----|-------------|----------|
| MVP | 1.0 | 30,000 |
| 完整版 | 2.0 | 60,000 |
| 维护（年） | 0.5 | 15,000 |

### 9.2 对比现有方案

| 方案 | 3年总成本 | 说明 |
|-----|----------|------|
| ScoutPanel（自建） | 135,000 | 开发 + 维护 |
| Vibe Kanban | 37,000 | 开源方案 + 定制 |
| Aviator Runbooks | 190,000 | 商业方案 |

---

## 十、结论与建议

### 10.1 方案选择

| 场景 | 推荐方案 |
|-----|---------|
| 快速验证 | 使用现有工具（Claude Code CLI + 脚本） |
| 长期使用 | 开发 ScoutPanel MVP |
| 企业级 | 考虑 Aviator Runbooks |

### 10.2 推荐路径

1. **短期（1周）**：用 Claude Code CLI + 脚本验证需求
2. **中期（4周）**：开发 ScoutPanel MVP
3. **长期**：根据使用情况决定是否扩展

### 10.3 立即可执行的脚本方案

如果暂不开发完整工具，可用以下脚本快速实现需求：

```bash
# 1. 多窗口管理脚本（PowerShell）
New-Terminal -Name "Task1" -Command "claude --dir .\task1"

# 2. 窗口标题更新（需 Terminal 支持）
Update-Title -Window "Task1" -Title "[Claude] 市场调研 - 运行中"

# 3. 提示音（PowerShell）
Add-Type -AssemblyName System.speech
$speak = New-Object System.Speech.Synthesis.SpeechSynthesizer
$speak.Speak("任务完成")
```

---

## 附录

### A. 参考资料

- LeanSpec v0.7 概念文档
- Vibe Kanban 架构设计
- ratatui TUI 框架文档

### B. 术语表

| 术语 | 定义 |
|-----|------|
| ScoutPanel | 本工具名称 |
| Agent Adapter | Agent 适配器，负责与具体 Agent 通信 |
| Event Bus | 事件总线，组件间通信机制 |
| TUI | 文本用户界面 |

---

**文档作者**：Claude Code
**文档版本**：v1.0
**最后更新**：2026年1月9日
