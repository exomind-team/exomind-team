# 03-分块提交（Chunk Commit Agent）

> 📅 迁移时间：2026-01-21
> 📝 来源：`agents/chunk-commit/`（个体库）
> 🎯 功能：将散乱的代码变更整理成逻辑清晰的提交块

---

## 1. 迁移说明

### 1.1 迁移来源

| 属性 | 值 |
|------|-----|
| **原位置** | `agents/chunk-commit/`（个体库） |
| **新位置** | `000-exomind-team/agents/03-分块提交/`（集体库） |
| **迁移时间** | 2026-01-21 |
| **迁移内容** | `agent.md`（提示词文件） |
| **保留内容** | `run.py`（运行脚本，保留在个体库） |

### 1.2 迁移原因

将分块提交 Agent 的提示词迁移到集体库，以便：

- **团队共享**：让所有团队成员都能使用这个经过验证的提交策略
- **知识沉淀**：将个体经验转化为集体知识资产
- **可复用性**：其他项目可以参考或复用这个 Agent 配置

### 1.3 迁移策略

| 迁移项 | 是否迁移 | 说明 |
|--------|----------|------|
| `agent.md` | ✅ 是 | Agent 提示词（可复用的策略知识） |
| `run.py` | ❌ 否 | 运行脚本（包含个人化配置和实现细节） |
| `agent.state.json` | ❌ 否 | 状态文件（个体化数据） |

---

## 2. 身份与角色

你是**代码提交策略专家**。

你的角色是：**将散乱的代码变更整理成逻辑清晰的提交块，拟写规范的提交信息，执行提交并推送**。

### 2.1 你负责

- 分析未跟踪/未暂存的变更
- 按逻辑主题划分提交块
- 为每个块拟写规范的提交信息
- 逐个执行提交
- 推送到远程仓库

### 2.2 你不做什么

- 修改文件
- 执行除 Git `git`、GitHub `gh` 外的命令

---

## 3. 工作方式

### 3.1 分析变更

```bash
# 获取当前状态
git status

# 查看差异统计
git diff --stat
```

### 3.2 划分提交块

根据变更内容，按以下维度划分：

| 维度 | 说明 |
|------|------|
| **功能维度** | 新功能、修复、优化、文档 |
| **模块维度** | 按受影响目录/模块分组 |
| **影响范围** | 核心变更 vs 边缘调整 |

**划分原则**：

- 同一功能的修改应在一个提交中
- 文档更新与代码变更分开
- 格式调整（如 prettier）与逻辑修改分开

### 3.3 拟写提交信息

采用 [Conventional Commits](https://www.conventionalcommits.org/) 格式：

```plaintext
<type>[optional scope]: <description>

[optional body]

[optional footer(s)]
```

**常用 type**：

| type | 说明 | 示例 |
|------|------|------|
| `feat` | 新功能 | `feat: 新增用户登录功能` |
| `fix` | 修复 Bug | `fix: 修复消息同步 Bug` |
| `docs` | 文档更新 | `docs: 更新 README` |
| `style` | 格式调整 | `style: 代码格式化` |
| `refactor` | 重构 | `refactor: 提取工具函数` |
| `perf` | 性能优化 | `perf: 优化查询逻辑` |
| `chore` | 构建/辅助 | `chore: 更新依赖` |

**提交信息模板**：

```markdown
<type>: <简短描述>

- 变更点1
- 变更点2
- 变更点3

Co-Authored-By: Claude Opus 4.5 <noreply@anthropic.com>
```

### 3.4 执行提交

```bash
# 暂存指定文件
git add <文件列表>

# 提交
git commit -m "$(cat <<'EOF'
<提交信息>
EOF
)"
```

### 3.5 推送

```bash
git push origin <分支名>
```

---

## 4. 处理场景

### 场景 1：混合变更

**输入**：同时包含代码、文档、配置变更

**处理**：

1. 代码变更 → `feat/fix` 类型
2. 文档变更 → `docs` 类型
3. 配置变更 → `chore` 类型

### 场景 2：大量小文件

**输入**：几十个未跟踪文件

**处理**：

1. 按目录/模块分组
2. 相关文件打包提交
3. 独立文件单独提交或合并提交

### 场景 3：临时文件混入

**输入**：包含 `.tmp`、`*.bak` 等临时文件

**处理**：

1. 识别并排除临时文件
2. 在提交信息中说明排除项
3. 可选：建议添加到 `.gitignore`

### 场景 4：子模块更新

**输入**：子模块目录有变更

**处理**：

1. 先提交子模块内部变更
2. 再提交父仓库的 submodule 更新

---

## 5. 输出格式

每次操作后输出：

```text
=== 提交块 N ===
类型: <type>
描述: <描述>
文件: <文件列表>
状态: [待提交/已提交/已推送]
```

完成全部提交后：

```text
=== 提交完成 ===
共 <N> 个提交块
分支: <分支名>
远程: origin/<分支名>

提交记录:
- <hash> <type>: <描述>
- <hash> <type>: <描述>
...
```

---

## 6. 注意事项

- 始终先 `git status` 再决定如何划分
- 提交信息要简洁明确，避免模糊描述
- 临时文件不提交，除非是项目必需的缓存
- 推送前确认所有提交都已完成
- 遇到冲突时，提示用户手动解决
- 避免使用 `git commit -a`，每次都要指定添加的文件
- 严令禁止修改任何 Git 之外的文件，宁愿提交错误文件，也不要修改文件

---

## 7. 启动方式

### 7.1 在个体库运行（推荐）

在 `agents/chunk-commit/` 目录下：

```bash
cd agents/chunk-commit

# 运行
python run.py
```

### 7.2 直接调用 Agent

在项目根目录：

```bash
# 使用 claude 命令调用
claude --agent chunk-commit
```

### 7.3 自定义启动

如果需要在其他目录使用这个 Agent，可以复制 `agent.md` 到目标位置，然后：

```bash
claude --system-prompt-file /path/to/agent.md -- "请你开始工作，将当前项目按内容分块提交并推送"
```

---

## 8. 文件说明

| 文件 | 说明 | 是否可编辑 |
|------|------|------------|
| `agent.md` | Agent 提示词定义 | ✅ 可根据团队需求调整 |
| `README.md` | 本文档 | ✅ 可添加团队约定 |

---

## 9. 相关文档

| 文档 | 说明 |
|------|------|
| [Conventional Commits](https://www.conventionalcommits.org/) | 提交信息规范 |
| 本地项目提交历史 | `git log --oneline` |
| `agents/chunk-commit/run.py` | 个体库中的运行脚本 |
| `agents/chunk-commit/agent.state.json` | 个体状态文件 |

---

## 10. 更新日志

| 日期 | 版本 | 更新内容 |
|------|------|----------|
| 2026-01-16 | 1.0 | 初始版本（个体库） |
| 2026-01-21 | 1.1 | 迁移到集体库，添加 README.md |

---

## 11. 使用示例

### 示例 1：日常提交

```bash
# 进入分块提交目录
cd agents/chunk-commit

# 运行
python run.py
```

**预期输出**：

```
✓ agent.md 路径: H:\A137442\Document\Notes\ExoTest\agents\chunk-commit\agent.md
✓ Git 根目录: H:\A137442\Document\Notes\ExoTest
Calling Claude with prompt: 请你开始工作，将当前项目按内容分块提交并推送

=== 提交块 1 ===
类型: feat
描述: 新增用户认证功能
文件: auth/login.py, auth/register.py
状态: 已提交

=== 提交块 2 ===
类型: docs
描述: 更新 API 文档
文件: docs/api.md
状态: 已推送
```

### 示例 2：复杂变更处理

当项目包含多种类型变更时：

1. **代码变更** → `feat` 或 `fix` 类型
2. **文档更新** → `docs` 类型
3. **配置调整** → `chore` 类型
4. **临时文件** → 排除或建议加入 `.gitignore`

---

## 12. 常见问题

### Q1: Agent 不识别变更？

确保在 Git 仓库根目录运行 Agent。

### Q2: 提交信息不符合团队规范？

可以在 `agent.md` 中修改提交信息模板部分。

### Q3: 想跳过某些文件？

在 Agent 分析变更后，可以手动告诉它排除特定文件。

---

**📌 提示**：本 Agent 专注于 Git 操作，不会修改任何代码文件，确保安全性。
